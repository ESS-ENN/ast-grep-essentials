id: detect-replaceall-sanitization
language: javascript
message: >-
  Detected a call to replace or replaceAll in an attempt to HTML escape the string `$STR`.
  Manually sanitizing input through a manually built list can be circumvented
  in many situations, and it's better to use a well known sanitization library
  such as `sanitize-html` or `DOMPurify`.
metadata:
  category: security
  owasp: >-
    A07:2017 - Cross-Site Scripting (XSS)
    A03:2021 - Injection
  cwe: "CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')"
  references: >-
    https://www.npmjs.com/package/dompurify
    https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
  cwe2022-top25: true
  cwe2021-top25: true
  subcategory: audit
  likelihood: LOW
  impact: LOW
  confidence: LOW
rule:
  any:
    - pattern: $STR.replace('<', '&lt;')
    - pattern: $STR.replaceAll('<', '&lt;')
    - pattern: $STR.replace('>', '&gt;')
    - pattern: $STR.replaceAll('>', '&gt;')
    - pattern: $STR.replace('"', '&quot;')
    - pattern: $STR.replaceAll('"', '&quot;')
    - pattern: $STR.replace("'", '&apos;')
    - pattern: $STR.replaceAll("'", '&apos;')
    - pattern: $STR.replace('&', '&amp;')
    - pattern: $STR.replaceAll('&', '&amp;')

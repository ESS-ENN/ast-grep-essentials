id: java-jwt-hardcoded-secret-java
severity: warning
language: java
message: >-
  A hard-coded credential was detected. It is not recommended to store
  credentials in source-code, as this risks secrets being leaked and used by
  either an internal or external malicious adversary. It is recommended to
  use environment variables to securely provide credentials or retrieve
  credentials from a secure vault or HSM (Hardware Security Module).
note: >-
  [CWE-798] Use of Hard-coded Credentials.
  [REFERENCES]
      - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
utils:
  $ALGO.$HMAC("$Y"):
      kind: string_literal
      inside:
        stopBy: end
        kind: local_variable_declaration
        all:
        - has:
            stopBy: neighbor
            kind: type_identifier
            regex: '^Algorithm$'
        - has:
            stopBy: neighbor
            kind: variable_declarator
            all:
              - has:
                  stopBy: neighbor
                  pattern: $$$
              - has:
                  stopBy: neighbor
                  kind: method_invocation
                  all:
                    - has:
                        stopBy: neighbor
                        pattern: $$$
                    - has:
                        stopBy: neighbor
                        kind: identifier
                        regex: (^HMAC384|HMAC256|HMAC512$)
                    - has:
                        stopBy: neighbor
                        kind: argument_list
                        has:
                            stopBy: neighbor
                            kind: string_literal
                            pattern: $S
  $ALGO.$HMAC($SECRET):
    kind: string_literal
    all:
    - inside:
        stopBy: neighbor
        kind: variable_declarator
        all:
          - has:
              stopBy: neighbor
              kind: identifier
              pattern: $T
          - has:
              stopBy: neighbor
              kind: string_literal
              pattern: $S
    - inside:
       stopBy: end
       kind: class_declaration
       has:
                  stopBy: end
                  kind: method_declaration
                  has:
                    stopBy: end
                    kind: local_variable_declaration
                    all:
                      - has:
                          stopBy: neighbor
                          kind: type_identifier
                          regex: '^Algorithm$'
                      - has:
                          stopBy: neighbor
                          kind: variable_declarator
                          all:
                            - has:
                                stopBy: neighbor
                                kind: identifier
                            - has:
                                stopBy: neighbor
                                kind: method_invocation
                                all:
                                  - has:
                                      stopBy: neighbor
                                      pattern: $$$
                                  - has:
                                      stopBy: neighbor
                                      kind: identifier
                                      regex: (^HMAC384|HMAC256|HMAC512$)
                                  - has:
                                        stopBy: neighbor
                                        kind: argument_list
                                        has:
                                            stopBy: neighbor
                                            kind: identifier
                                            pattern: $T
rule:
  kind: string_literal
  any:
    - matches: $ALGO.$HMAC("$Y")
    - matches: $ALGO.$HMAC($SECRET) 
constraints:
    S:
      not:
       regex: ^""$

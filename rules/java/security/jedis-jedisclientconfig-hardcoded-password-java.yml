id: jedis-jedisclientconfig-hardcoded-password-java
severity: warning
language: java
message: >-
  A secret is hard-coded in the application. Secrets stored in source
  code, such as credentials, identifiers, and other types of sensitive data,
  can be leaked and used by internal or external malicious actors. Use
  environment variables to securely provide credentials and other secrets or
  retrieve them from a secure vault or Hardware Security Module (HSM)
note: >-
  [CWE-798] Use of Hard-coded Credentials.
  [REFERENCES]
      - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
utils:
  redis.clients.jedis.DefaultJedisClientConfig.builder(). ... .password:
    # redis.clients.jedis.DefaultJedisClientConfig.builder(). ....password("...")
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: method_invocation
          pattern: redis.clients.jedis.DefaultJedisClientConfig.builder()
      - has:
          stopBy: end
          kind: identifier
          regex: ^password$
      - has:
          stopBy: neighbor
          kind: argument_list
          has:
            stopBy: neighbor
            kind: string_literal
            pattern: $P
  redis.clients.jedis.DefaultJedisClientConfig.Builder $JEDIS). ... .password("..."):
    #  (redis.clients.jedis.DefaultJedisClientConfig.Builder $JEDIS).... .password("...")
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: identifier
          pattern: $B
      - has:
          stopBy: end
          kind: identifier
          regex: ^password$
      - has:
          stopBy: neighbor
          kind: argument_list
          has:
            stopBy: neighbor
            kind: string_literal
            pattern: $S
      - inside:
          stopBy: end
          kind: expression_statement
          follows:
            stopBy: end
            kind: local_variable_declaration
            all:
              - has:
                  stopBy: neighbor
                  kind: scoped_type_identifier
                  pattern: redis.clients.jedis.DefaultJedisClientConfig.Builder
              - has:
                  stopBy: neighbor
                  kind: variable_declarator
                  has:
                    stopBy: neighbor
                    kind: identifier
                    pattern: $B
  redis.clients.jedis.DefaultJedisClientConfig.create("..."):
    # redis.clients.jedis.DefaultJedisClientConfig.create($CONNECTIONTIMEOUTMILLIS,$SOTIMEOUTMILLIS, $BLOCKINGSOCKETTIMEOUTMILLIS, $USER, "...",...)
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: field_access
          regex: ^redis.clients.jedis.DefaultJedisClientConfig$
      - has:
          stopBy: neighbor
          kind: identifier
          regex: ^create$
      - has:
          stopBy: neighbor
          kind: argument_list
          all:
            - has:
                stopBy: end
                kind: string_literal
                nthChild: 5
                pattern: $P
            - has:
                stopBy: neighbor
                nthChild: 6
                pattern: $$$
  new redis.clients.jedis.DefaultJedisClientConfig.create("..."):
    # new redis.clients.jedis.DefaultJedisClientConfig($CONNECTIONTIMEOUTMILLIS, $SOTIMEOUTMILLIS, $BLOCKINGSOCKETTIMEOUTMILLIS, $USER, "...", ...)
    kind: object_creation_expression
    all:
      - has:
          stopBy: neighbor
          kind: scoped_type_identifier
          regex: ^redis.clients.jedis.DefaultJedisClientConfig$
      - has:
          stopBy: neighbor
          kind: argument_list
          all:
            - has:
                stopBy: end
                kind: string_literal
                nthChild: 5
                pattern: $P
            - has:
                stopBy: neighbor
                nthChild: 6
                pattern: $$$
  (redis.clients.jedis.JedisClientConfig  $JEDIS).updatePassword("..."):
    # (redis.clients.jedis.JedisClientConfig  $JEDIS).updatePassword("...")
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: identifier
          pattern: $A
      - has:
          stopBy: neighbor
          kind: identifier
          regex: ^updatePassword$
      - has:
          stopBy: neighbor
          kind: argument_list
          has:
            stopBy: neighbor
            kind: string_literal
            pattern: $P
      - inside:
          stopBy: end
          kind: expression_statement
          follows:
            stopBy: end
            kind: local_variable_declaration
            all:
              - has:
                  stopBy: neighbor
                  kind: scoped_type_identifier
                  regex: ^redis.clients.jedis.JedisClientConfig|redis.clients.jedis.DefaultJedisClientConfig$
              - has:
                  stopBy: neighbor
                  kind: variable_declarator
                  has:
                    stopBy: neighbor
                    kind: identifier
                    pattern: $A
  DefaultJedisClientConfig.builder(). ... .password("..."):
    # DefaultJedisClientConfig.builder(). ... .password("...")
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: method_invocation
          pattern: DefaultJedisClientConfig.builder()
      - has:
          stopBy: end
          kind: identifier
          regex: ^password$
      - has:
          stopBy: neighbor
          kind: argument_list
          has:
            stopBy: neighbor
            kind: string_literal
            pattern: $P
      - inside:
          stopBy: end
          kind: program
          has:
            stopBy: end
            kind: import_declaration
            has:
              stopBy: neighbor
              kind: scoped_identifier
              regex: ^redis.clients.jedis.*
  (DefaultJedisClientConfig.Builder $JEDIS). ... .password("..."):
    # (DefaultJedisClientConfig.Builder $JEDIS). ... .password("...")
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: identifier
          pattern: $S
      - has:
          stopBy: end
          kind: identifier
          regex: ^password$
      - has:
          stopBy: neighbor
          kind: argument_list
          has:
            stopBy: neighbor
            kind: string_literal
            pattern: $P
      - inside:
          stopBy: end
          kind: expression_statement
          follows:
            stopBy: end
            kind: local_variable_declaration
            all:
            - has:
                stopBy: neighbor
                kind: scoped_type_identifier
                regex: DefaultJedisClientConfig.Builder
            - has:
                stopBy: neighbor
                kind: variable_declarator
                has:
                  stopBy: neighbor
                  kind: identifier
                  pattern: $S
      - inside:
          stopBy: end
          kind: program
          has:
            stopBy: end
            kind: import_declaration
            has:
              stopBy: neighbor
              kind: scoped_identifier
              regex: ^redis.clients.jedis.*
  DefaultJedisClientConfig.create( "..."):
    # DefaultJedisClientConfig.create($CONNECTIONTIMEOUTMILLIS,$SOTIMEOUTMILLIS,$BLOCKINGSOCKETTIMEOUTMILLIS, $USER, "...",...)
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: identifier
          regex: ^DefaultJedisClientConfig$
      - has:
          stopBy: neighbor
          kind: identifier
          regex: ^create$
      - has:
          stopBy: neighbor
          kind: argument_list
          all:
            - has:
                stopBy: end
                kind: string_literal
                nthChild: 5
                pattern: $P
            - has:
                stopBy: neighbor
                nthChild: 6
                pattern: $$$
      - inside:
          stopBy: end
          kind: program
          has:
            stopBy: end
            kind: import_declaration
            has:
              stopBy: neighbor
              kind: scoped_identifier
              regex: ^redis.clients.jedis.*
  new DefaultJedisClientConfig("..."):
    # new DefaultJedisClientConfig($CONNECTIONTIMEOUTMILLIS, $SOTIMEOUTMILLIS, $BLOCKINGSOCKETTIMEOUTMILLIS, $USER, "...", ...)
    kind: object_creation_expression
    all:
      - has:
          stopBy: neighbor
          kind: type_identifier
          regex: ^DefaultJedisClientConfig$
      - has:
          stopBy: neighbor
          kind: argument_list
          all:
            - has:
                stopBy: end
                kind: string_literal
                nthChild: 5
                pattern: $P
            - has:
                stopBy: neighbor
                nthChild: 6
                pattern: $$$
      - inside:
          stopBy: end
          kind: program
          has:
            stopBy: end
            kind: import_declaration
            has:
              stopBy: neighbor
              kind: scoped_identifier
              regex: ^redis.clients.jedis.*
  (JedisClientConfig $JEDIS).updatePassword("..."):
    # (JedisClientConfig $JEDIS).updatePassword("...")
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: identifier
          pattern: $W
      - has:
          stopBy: neighbor
          kind: identifier
          regex: 'updatePassword'
      - has:
          stopBy: neighbor
          kind: argument_list
          has:
            stopBy: neighbor
            kind: string_literal
            pattern: $P
      - inside:
          stopBy: neighbor
          kind: expression_statement
          follows:
            stopBy: end
            kind: local_variable_declaration
            all:
              - has:
                 stopBy: neighbor
                 kind: type_identifier
                 regex: ^JedisClientConfig|DefaultJedisClientConfig$
              - has:
                  stopBy: neighbor
                  kind: variable_declarator
                  has:
                    stopBy: neighbor
                    kind: identifier
                    pattern: $W
      - inside:
          stopBy: end
          kind: program
          has:
            stopBy: end
            kind: import_declaration
            has:
              stopBy: neighbor
              kind: scoped_identifier
              regex: ^redis.clients.jedis.*
  jedis.DefaultJedisClientConfig.builder(). ... .password("..."):
    # jedis.DefaultJedisClientConfig.builder(). ... .password("...")
   kind: method_invocation
   all:
     - has:
         stopBy: neighbor
         kind: method_invocation
         pattern: jedis.DefaultJedisClientConfig.builder() 
     - has:
         stopBy: end
         kind: identifier
         regex: ^password$
     - has:
         stopBy: neighbor
         kind: argument_list
         has:
           stopBy: neighbor
           kind: string_literal
           pattern: $P
     - inside:
         stopBy: end
         kind: program
         has:
          stopBy: end
          kind: import_declaration
          has:
            stopBy: neighbor
            kind: scoped_identifier
            regex: ^redis.clients.*
  (jedis.DefaultJedisClientConfig.Builder $JEDIS). ... .password("..."):
    # (jedis.DefaultJedisClientConfig.Builder $JEDIS). ... .password("...")
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: identifier
          pattern: $O
      - has:
          stopBy: neighbor
          kind: identifier  
          regex: ^password$
      - has:
          stopBy: neighbor
          kind: argument_list
          has:
            stopBy: neighbor
            kind: string_literal
            pattern: $P
      - inside:
          stopBy: end
          kind: expression_statement
          follows:
            stopBy: end
            kind: local_variable_declaration
            all:
              - has:
                  stopBy: neighbor
                  kind: scoped_type_identifier
                  regex: ^jedis.DefaultJedisClientConfig.Builder$
              - has:
                  stopBy: neighbor
                  kind: variable_declarator
                  has:
                    stopBy: neighbor
                    kind: identifier
                    pattern: $O
      - inside:
          stopBy: end
          kind: program
          has:
            stopBy: end
            kind: import_declaration
            has:
              stopBy: neighbor
              kind: scoped_identifier
              regex: ^redis.clients.*
  jedis.DefaultJedisClientConfig.create("..."):
    # jedis.DefaultJedisClientConfig.create($CONNECTIONTIMEOUTMILLIS, $SOTIMEOUTMILLIS, $BLOCKINGSOCKETTIMEOUTMILLIS, $USER, "...", ...)
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: field_access
          regex: ^jedis.DefaultJedisClientConfig$
      - has:
          stopBy: neighbor
          kind: identifier
          regex: ^create$
      - has:
          stopBy: neighbor
          kind: argument_list
          all:
            - has:
                stopBy: end
                kind: string_literal
                nthChild: 5
                pattern: $P
            - has:
                stopBy: neighbor
                nthChild: 6
                pattern: $$$
      - inside:
          stopBy: end
          kind: program
          has:
            stopBy: end
            kind: import_declaration
            has:
              stopBy: neighbor
              kind: scoped_identifier
              regex: ^redis.clients.*
  new jedis.DefaultJedisClientConfig.create("..."):
    # new jedis.DefaultJedisClientConfig.create($CONNECTIONTIMEOUTMILLIS, $SOTIMEOUTMILLIS, $BLOCKINGSOCKETTIMEOUTMILLIS, $USER, "...", ...)
    kind: object_creation_expression
    all:
      - has:
          stopBy: neighbor
          kind: scoped_type_identifier
          regex: ^jedis.DefaultJedisClientConfig.create$
      - has:
          stopBy: neighbor
          kind: argument_list
          all:
            - has:
                stopBy: end
                kind: string_literal
                nthChild: 5
                pattern: $P
            - has:
                stopBy: neighbor
                nthChild: 6
                pattern: $$$
      - inside:
          stopBy: end
          kind: program
          has:
            stopBy: end
            kind: scoped_identifier
            regex: ^redis.clients.*
  (jedis.JedisClientConfig $JEDIS).updatePassword("..."):
    # (jedis.JedisClientConfig $JEDIS).updatePassword("...")
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: identifier  
          pattern: $R
      - has:
          stopBy: neighbor                                  
          kind: identifier
          regex: ^updatePassword$
      - has:
          stopBy: neighbor
          kind: argument_list
          has:
            stopBy: neighbor
            kind: string_literal
            pattern: $P
      - inside:
          stopBy: end
          kind: program
          has:
            stopBy: end
            kind: import_declaration
            has:
              stopBy: end
              kind: scoped_identifier
              regex: ^redis.clients.*
      - inside:
          stopBy: end
          kind: expression_statement
          follows:
            stopBy: end
            kind: local_variable_declaration
            all:
            - has:
               stopBy: neighbor
               kind: scoped_type_identifier
               regex: ^jedis.JedisClientConfig|jedis.DefaultJedisClientConfig$
            - has:
                stopBy: neighbor
                kind: variable_declarator
                has:
                  stopBy: neighbor
                  kind: identifier
                  pattern: $R
  clients.jedis.DefaultJedisClientConfig.builder(). ... .password("..."):
    # clients.jedis.DefaultJedisClientConfig.builder(). ... .password("...")  
   kind: method_invocation
   all:
     - has:
         stopBy: neighbor
         kind: method_invocation
         pattern: clients.jedis.DefaultJedisClientConfig.builder()
     - has:
         stopBy: neighbor
         kind: identifier
         regex: ^password$
     - has:
         stopBy: neighbor
         kind: argument_list
         has:
           stopBy: neighbor
           kind: string_literal
           pattern: $P
     - inside:
         stopBy: end
         kind: program
         has:
            stopBy: end
            kind: import_declaration
            has:
              stopBy: neighbor
              kind: identifier
              regex: ^redis.*
  (clients.jedis.DefaultJedisClientConfig.Builder $JEDIS). ... .password("..."):
    # (clients.jedis.DefaultJedisClientConfig.Builder $JEDIS). ... .password("...")
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: identifier
          pattern: $D
      - has:
          stopBy: neighbor
          kind: identifier
          regex: ^password$
      - has:
          stopBy: neighbor
          kind: argument_list
          has:
            stopBy: neighbor
            kind: string_literal
            pattern: $P
      - inside:
          stopBy: end
          kind: expression_statement
          follows:
            stopBy: end
            kind: local_variable_declaration
            all:
              - has:
                  stopBy: neighbor
                  kind: scoped_type_identifier
                  regex: ^clients.jedis.DefaultJedisClientConfig.Builder$
              - has:
                  stopBy: neighbor
                  kind: variable_declarator
                  has:
                    stopBy: neighbor
                    kind: identifier
                    pattern: $D
      - inside:
          stopBy: end
          kind: program
          has: 
            stopBy: end
            kind: import_declaration
            has: 
              stopBy: neighbor
              kind: identifier
              regex: ^redis.*
  clients.jedis.DefaultJedisClientConfig.create("..."):
    # clients.jedis.DefaultJedisClientConfig.create($CONNECTIONTIMEOUTMILLIS, $SOTIMEOUTMILLIS, $BLOCKINGSOCKETTIMEOUTMILLIS, $USER, "...", ...)
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: field_access
          regex: ^clients.jedis.DefaultJedisClientConfig$
      - has:
          stopBy: neighbor
          kind: identifier
          regex: ^create$
      - has:
          stopBy: neighbor
          kind: argument_list
          all:
            - has:
                stopBy: end
                kind: string_literal
                nthChild: 5
                pattern: $P
            - has:
                stopBy: neighbor
                nthChild: 6
                pattern: $$$
      - inside:
          stopBy: end
          kind: program
          has: 
            stopBy: end
            kind: import_declaration
            has: 
              stopBy: neighbor
              kind: identifier
              regex: ^redis.*
  new clients.jedis.DefaultJedisClientConfig("..."):
    # new clients.jedis.DefaultJedisClientConfig($CONNECTIONTIMEOUTMILLIS, $SOTIMEOUTMILLIS, $BLOCKINGSOCKETTIMEOUTMILLIS, $USER, "...",...)
    kind: object_creation_expression
    all:
      - has:
          stopBy: neighbor
          kind: scoped_type_identifier
          regex: ^clients.jedis.DefaultJedisClientConfig.create$
      - has:
          stopBy: neighbor
          kind: argument_list
          all:
            - has:
                stopBy: end
                kind: string_literal
                nthChild: 5
                pattern: $P
            - has:
                stopBy: neighbor
                nthChild: 6
                pattern: $$$
      - inside:
          stopBy: end
          kind: program
          has: 
            stopBy: end
            kind: import_declaration
            has: 
              stopBy: neighbor
              kind: identifier
              regex: ^redis.*
  (clients.jedis.JedisClientConfig $JEDIS).updatePassword("..."):
    # (clients.jedis.JedisClientConfig $JEDIS).updatePassword("...")
    kind: method_invocation
    all:
      - has:
          stopBy: neighbor
          kind: identifier
          pattern: $I
      - has:
          stopBy: neighbor
          kind: identifier
          regex: 'updatePassword'
      - has:
          stopBy: neighbor
          kind: argument_list
          has:
            stopBy: neighbor
            kind: string_literal
            pattern: $P
      -  inside:
          stopBy: neighbor
          kind: expression_statement
          follows:
            stopBy: end
            kind: local_variable_declaration
            all:
              - has:
                 stopBy: neighbor
                 kind: scoped_type_identifier
                 regex: ^clients.jedis.JedisClientConfig|clients.jedis.DefaultJedisClientConfig$
              - has:
                  stopBy: neighbor
                  kind: variable_declarator
                  has:
                    stopBy: neighbor
                    kind: identifier
                    pattern: $I
      - inside:
          stopBy: end
          kind: program
          has:
            stopBy: end
            kind: import_declaration
            has:
              stopBy: neighbor
              kind: identifier
              regex: ^redis.*
rule:
  any:
  - kind: method_invocation
    any:
     - matches: redis.clients.jedis.DefaultJedisClientConfig.builder(). ... .password
     - matches: redis.clients.jedis.DefaultJedisClientConfig.Builder $JEDIS). ... .password("...")
     - matches: redis.clients.jedis.DefaultJedisClientConfig.create("...")
     - matches: (redis.clients.jedis.JedisClientConfig  $JEDIS).updatePassword("...")
     - matches: DefaultJedisClientConfig.builder(). ... .password("...")
     - matches: (DefaultJedisClientConfig.Builder $JEDIS). ... .password("...")
     - matches: DefaultJedisClientConfig.create( "...")
     - matches: (JedisClientConfig $JEDIS).updatePassword("...")
     - matches: jedis.DefaultJedisClientConfig.builder(). ... .password("...")
     - matches: (jedis.DefaultJedisClientConfig.Builder $JEDIS). ... .password("...")
     - matches: jedis.DefaultJedisClientConfig.create("...")
     - matches: (jedis.JedisClientConfig $JEDIS).updatePassword("...")
     - matches: clients.jedis.DefaultJedisClientConfig.builder(). ... .password("...")
     - matches: (clients.jedis.DefaultJedisClientConfig.Builder $JEDIS). ... .password("...")
     - matches: clients.jedis.DefaultJedisClientConfig.create("...")
     - matches: (clients.jedis.JedisClientConfig $JEDIS).updatePassword("...")
  - kind: object_creation_expression
    any:
      - matches: new redis.clients.jedis.DefaultJedisClientConfig.create("...")
      - matches: new DefaultJedisClientConfig("...")
      - matches: new jedis.DefaultJedisClientConfig.create("...")
      - matches: new clients.jedis.DefaultJedisClientConfig("...")
constraints:
  P:
    not:
      regex: ^""$

id: passwordauthentication-hardcoded-password-java
language: java
severity: warning
message: >-
  A secret is hard-coded in the application. Secrets stored in source
  code, such as credentials, identifiers, and other types of sensitive data,
  can be leaked and used by internal or external malicious actors. Use
  environment variables to securely provide credentials and other secrets or
  retrieve them from a secure vault or Hardware Security Module (HSM).
note: >-
  [CWE-798]: Use of Hard-coded Credentials
  [OWASP A05:2021]: Identification and Authentication Failures
  [REFERENCES]
      - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
utils:
  match_string_literal:
    kind: string_literal
    inside:
      stopBy: end
      kind: method_invocation
      all:
        - has:
            stopBy: end
            kind: identifier
            field: name
            regex: "^toCharArray$"
        - has:
            stopBy: end
            kind: argument_list
            field: arguments
      inside:
        stopBy: end
        kind: argument_list
        inside:
          stopBy: end
          kind: object_creation_expression
          has:
            stopBy: end
            kind: type_identifier
            field: type
            regex: "^PasswordAuthentication$"
  match_identifier_in_argumentlist:
    kind: identifier
    pattern: $ASDF
    inside:
      stopBy: end
      kind: argument_list
      has:
        stopBy: end
        kind: string_literal
      inside:
        stopBy: end
        kind: object_creation_expression
        has:
          stopBy: end
          kind: type_identifier
          field: type
          regex: "^PasswordAuthentication$"
        inside:
          stopBy: end
          kind: expression_statement
          follows:
            stopBy: end
            kind: local_variable_declaration
            all:
              - has:
                  stopBy: end
                  kind: array_type
                  field: type
                  all:
                    - has:
                        stopBy: end
                        kind: integral_type
                        field: element
                    - has:
                        stopBy: end
                        kind: dimensions
                        field: dimensions
              - has:
                  stopBy: end
                  kind: variable_declarator
                  field: declarator
                  all:
                    - has:
                        stopBy: end
                        kind: identifier
                        pattern: $ASDF
                    - has:
                        stopBy: end
                        kind: method_invocation
                        all:
                          - has:
                              stopBy: end
                              kind: string_literal
                              field: object
                          - has:
                              stopBy: end
                              kind: identifier
                              field: name
                              regex: "^toCharArray$"
                          - has:
                              stopBy: end
                              kind: argument_list
                              field: arguments

rule:
  any:
    - matches: match_string_literal
    - matches: match_identifier_in_argumentlist

id: system-setproperty-hardcoded-secret-java
language: java
severity: warning
message: >-
    A secret is hard-coded in the application. Secrets stored in source
    code, such as credentials, identifiers, and other types of sensitive data,
    can be leaked and used by internal or external malicious actors. Use
    environment variables to securely provide credentials and other secrets or
    retrieve them from a secure vault or Hardware Security Module (HSM).
note: >-
  [CWE-798]: Use of Hard-coded Credentials
  [OWASP A07:2021]: Identification and Authentication Failures
  [REFERENCES]
      - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
utils:
  match_string_literal:
    kind: string_literal
    nthChild: 2
    not:
      regex: ^""$
    inside:
      stopBy: end
      kind: argument_list
      has:
        kind: string_literal
        any:
          - has:
              kind: string_fragment
              regex: "^javax.net.ssl.keyStorePassword$"
          - has:
              kind: string_fragment
              regex: "^javax.net.ssl.trustStorePassword$"
      inside:
        stopBy: end
        kind: method_invocation
        all:
          - has:
              stopBy: end
              field: object
              kind: identifier
              regex: "^System$"
          - has:
              stopBy: end
              field: name
              kind: identifier
              regex: "^setProperty$"
        inside:
          kind: expression_statement
rule:
  any:
    - matches: match_string_literal

id: use-of-weak-rsa-key-java
language: java
severity: warning
message: >-
  RSA keys should be at least 2048 bits based on NIST recommendation.
note: >-
  [CWE-326] Inadequate Encryption Strength.
  [REFERENCES]
      - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#algorithms
utils:
  WeakRSA:
    kind: expression_statement
    all:
      - has:
          stopBy: neighbor                                                                          
          kind: method_invocation
          all:
            - has:
                stopBy: neighbor
                kind: identifier
            - has:
                stopBy: neighbor
                kind: identifier
                regex: '^initialize$'
            - has:
                stopBy: neighbor
                kind: argument_list
                has:
                  stopBy: neighbor
                  any:
                    - kind: decimal_integer_literal
                      pattern: $AST
                    - kind: decimal_floating_point_literal
                      pattern: $AST
                    - kind: unary_expression
                      pattern: $AST
      - follows:
          stopBy: neighbor
          pattern: KeyPairGenerator keyGen = KeyPairGenerator.getInstance("RSA")

rule:
  kind: expression_statement
  matches: WeakRSA
constraints: 
      AST:
        regex: '^(-?(0|[1-9][0-9]?|[1-9][0-9]{2}|1[0-9]{3}|20[0-3][0-9]|204[0-7])(\.[0-9]+)?|0|-[1-9][0-9]*|-[1-9][0-9]{2,}|-1[0-9]{3}|-20[0-3][0-9]|-204[0-7])$'

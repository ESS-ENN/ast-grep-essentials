id: python-mysql-hardcoded-secret-python
language: python
severity: warning
message: >-
  A secret is hard-coded in the application. Secrets stored in source code, such as credentials, identifiers, and other types of sensitive data, can be leaked and used by internal or external malicious actors. Use environment variables to securely provide credentials and other secrets or retrieve them from a secure vault or Hardware Security Module (HSM).
note: >-
  [CWE-798]: Use of Hard-coded Credentials
  [A07:2021]: Identification and Authentication Failures
  [REFERENCES]
    - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html

rule:
  any:
    - kind: call
      has:
        kind: attribute
        field: function
        regex: ^mysql.connector.connect$
        precedes:
          kind: argument_list
          has:
            kind: keyword_argument
            all:
              - has:
                  kind: identifier
                  nthChild: 1
                  regex: ^(password|passwd)$
              - has:
                  kind: string
                  nthChild: 2
                  all:
                    - has:
                        kind: string_start
                        nthChild: 1
                    - has:
                        kind: string_content
                        nthChild: 2
                    - has:
                        kind: string_end
                        nthChild: 3
      inside:
        stopBy: end
        follows:
          stopBy: end
          kind: import_statement
          has:
            kind: dotted_name
            nthChild: 1
            regex: ^mysql.connector$
    - kind: call
      has:
        kind: attribute
        field: function
        pattern: $CONNECTOR_ALIAS.connect
        precedes:
          kind: argument_list
          has:
            kind: keyword_argument
            all:
              - has:
                  kind: identifier
                  nthChild: 1
                  regex: ^(password|passwd)$
              - has:
                  kind: string
                  nthChild: 2
                  all:
                    - has:
                        kind: string_start
                        nthChild: 1
                    - has:
                        kind: string_content
                        nthChild: 2
                    - has:
                        kind: string_end
                        nthChild: 3
      inside:
        stopBy: end
        follows:
          stopBy: end
          kind: import_statement
          has:
            kind: aliased_import
            nthChild: 1
            all:
              - has:
                  kind: dotted_name
                  nthChild: 1
                  regex: ^mysql.connector$
              - has:
                  kind: identifier
                  field: alias
                  nthChild: 2
                  pattern: $CONNECTOR_ALIAS

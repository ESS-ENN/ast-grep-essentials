id: python-mariadb-empty-password-python
language: python
severity: warning
message: >-
  The application creates a database connection with an empty password. This can lead to unauthorized access by either an internal or external malicious actor. To prevent this vulnerability, enforce authentication when connecting to a database by using environment variables to securely provide credentials or retrieving them from a secure vault or HSM (Hardware Security Module).
note: >-
  [CWE-287]: Improper Authentication
  [A07:2021]: Identification and Authentication Failures
  [REFERENCES]
    - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html

rule:
  any:
    - kind: call
      has:
        nthChild: 1
        kind: attribute
        regex: ^mariadb.connect$
        precedes:
          kind: argument_list
          has:
            kind: keyword_argument
            has:
              kind: identifier
              regex: ^(password|passwd)$
              precedes:
                stopBy: end
                kind: string
                all:
                  - has:
                      kind: string_start
                      nthChild: 1
                  - has:
                      kind: string_end
                      nthChild: 2
      inside:
        stopBy: end
        follows:
          stopBy: end
          kind: import_statement
          has:
            kind: dotted_name
            nthChild: 1
            regex: ^mariadb$
    - kind: call
      has:
        nthChild: 1
        kind: attribute
        all:
          - has:
              nthChild: 1
              pattern: $ALAIS
          - has:
              nthChild: 2
              regex: ^connect$
        precedes:
          kind: argument_list
          has:
            kind: keyword_argument
            has:
              kind: identifier
              regex: ^(password|passwd)$
              precedes:
                stopBy: end
                kind: string
                all:
                  - has:
                      kind: string_start
                      nthChild: 1
                  - has:
                      kind: string_end
                      nthChild: 2
      inside:
        stopBy: end
        follows:
          stopBy: end
          kind: import_statement
          has:
            kind: aliased_import
            all:
              - has:
                  kind: dotted_name
                  regex: ^mariadb$
              - has:
                  kind: identifier
                  pattern: $ALAIS

id: python-webrepl-hardcoded-secret-python
language: python
severity: warning
message: >-
  A secret is hard-coded in the application. Secrets stored in source
  code, such as credentials, identifiers, and other types of sensitive data,
  can be leaked and used by internal or external malicious actors. Use
  environment variables to securely provide credentials and other secrets or
  retrieve them from a secure vault or Hardware Security Module (HSM).
note: >-
  [CWE-798]: Use of Hard-coded Credentials
  [OWASP A07:2021]: Identification and Authentication Failures
  [REFERENCES]
       https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
utils:
  match_call:
    kind: call
    all:
      - has:
          stopBy: end
          kind: attribute
          field: function
          all:
            - has:
                stopBy: end
                kind: identifier
                field: object
                regex: "^webrepl$"
            - has:
                stopBy: end
                kind: identifier
                field: attribute
                regex: "^start$"
      - has:
          stopBy: end
          kind: argument_list
          field: arguments
          has:
            stopBy: end
            kind: keyword_argument
            all:
              - has:
                  kind: identifier
                  field: name
                  regex: "^password$"
              - has:
                  kind: string
                  field: value
                  all:
                    - has:
                        kind: string_start
                    - has:
                        kind: string_content
                    - has:
                        kind: string_end
    inside:
      stopBy: end
      kind: expression_statement
  match_call_with_identifier:
    kind: call
    all:
      - has:
          stopBy: end
          kind: attribute
          field: function
          all:
            - has:
                stopBy: end
                kind: identifier
                field: object
                regex: "^webrepl$"
            - has:
                stopBy: end
                kind: identifier
                field: attribute
                regex: "^start$"
      - has:
          stopBy: end
          kind: argument_list
          field: arguments
          has:
            stopBy: end
            kind: keyword_argument
            all:
              - has:
                  kind: identifier
                  field: name
                  regex: "^password$"
              - has:
                  kind: identifier
                  field: value
                  pattern: $PASS
    inside:
      stopBy: end
      kind: expression_statement
      follows:
        stopBy: end
        kind: expression_statement
        has:
          stopBy: end
          kind: assignment
          all:
            - has:
                kind: identifier
                pattern: $PASS
            - has:
                kind: string
                all:
                  - has:
                      kind: string_start
                  - has:
                      kind: string_content
                  - has:
                      kind: string_end
rule:
  any:
    - matches: match_call
    - matches: match_call_with_identifier


id: python-cassandra-hardcoded-secret-python
language: python
severity: warning
message: >-
  A secret is hard-coded in the application. Secrets stored in source code, such as credentials, identifiers, and other types of sensitive data, can be leaked and used by internal or external malicious actors. Use environment variables to securely provide credentials and other secrets or retrieve them from a secure vault or Hardware Security Module (HSM).
note: >-
  [CWE-798]: Use of Hard-coded Credentials
  [A07:2021]: Identification and Authentication Failures
  [REFERENCES]
      - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html

rule:
  any:
    - kind: call
      any:
        - kind: call
          has:
            kind: identifier
            regex: ^PlainTextAuthProvider$
            precedes:
              kind: argument_list
              has:
                stopBy: end
                kind: keyword_argument
                all:
                  - has:
                      nthChild: 1
                      kind: identifier
                      regex: ^password$
                  - has:
                      nthChild: 2
                      kind: string
                      all:
                        - has:
                            kind: string_start
                            nthChild: 1
                        - has:
                            kind: string_content
                            nthChild: 2
                        - has:
                            kind: string_end
                            nthChild: 3
        - kind: call
          has:
            kind: identifier
            regex: ^PlainTextAuthProvider$
            precedes:
              kind: argument_list
              has:
                nthChild: 2
                kind: string
                all:
                  - has:
                      nthChild: 1
                      kind: string_start
                  - has:
                      kind: string_content
                      nthChild: 2
                  - has:
                      kind: string_end
                      nthChild: 3
      inside:
        stopBy: end
        follows:
          stopBy: end
          kind: import_from_statement
          all:
            - has:
                nthChild: 1
                kind: dotted_name
                field: module_name
                regex: ^cassandra.auth$
            - has:
                stopBy: end
                kind: dotted_name
                regex: ^PlainTextAuthProvider$
    - kind: call
      any:
        - kind: call
          has:
            kind: identifier
            regex: ^SaslAuthProvider$
            precedes:
              kind: argument_list
              has:
                stopBy: end
                kind: keyword_argument
                all:
                  - has:
                      nthChild: 1
                      kind: identifier
                      regex: ^password$
                  - has:
                      nthChild: 2
                      kind: string
                      all:
                        - has:
                            kind: string_start
                            nthChild: 1
                        - has:
                            kind: string_content
                            nthChild: 2
                        - has:
                            kind: string_end
                            nthChild: 3
      inside:
        stopBy: end
        follows:
          stopBy: end
          kind: import_from_statement
          all:
            - has:
                nthChild: 1
                kind: dotted_name
                field: module_name
                regex: ^cassandra.auth$
            - has:
                stopBy: end
                kind: dotted_name
                regex: ^SaslAuthProvider$
    - kind: call
      any:
        - kind: call
          has:
            kind: identifier
            pattern: $PLAIN_ALIAS
            precedes:
              kind: argument_list
              has:
                stopBy: end
                kind: keyword_argument
                all:
                  - has:
                      nthChild: 1
                      kind: identifier
                      regex: ^password$
                  - has:
                      nthChild: 2
                      kind: string
                      all:
                        - has:
                            kind: string_start
                            nthChild: 1
                        - has:
                            kind: string_content
                            nthChild: 2
                        - has:
                            kind: string_end
                            nthChild: 3
        - kind: call
          has:
            kind: identifier
            pattern: $PLAIN_ALIAS
            precedes:
              kind: argument_list
              has:
                nthChild: 2
                kind: string
                all:
                  - has:
                      nthChild: 1
                      kind: string_start
                  - has:
                      kind: string_content
                      nthChild: 2
                  - has:
                      kind: string_end
                      nthChild: 3
      inside:
        stopBy: end
        follows:
          stopBy: end
          kind: import_from_statement
          all:
            - has:
                nthChild: 1
                kind: dotted_name
                field: module_name
                regex: ^cassandra.auth$
            - has:
                stopBy: end
                kind: aliased_import
                all:
                  - has:
                      kind: dotted_name
                      nthChild: 1
                      regex: ^PlainTextAuthProvider$
                  - has:
                      kind: identifier
                      field: alias
                      nthChild: 2
                      pattern: $PLAIN_ALIAS
    - kind: call
      any:
        - kind: call
          has:
            kind: identifier
            pattern: $SASL_ALIAS
            precedes:
              kind: argument_list
              has:
                stopBy: end
                kind: keyword_argument
                all:
                  - has:
                      nthChild: 1
                      kind: identifier
                      regex: ^password$
                  - has:
                      nthChild: 2
                      kind: string
                      all:
                        - has:
                            kind: string_start
                            nthChild: 1
                        - has:
                            kind: string_content
                            nthChild: 2
                        - has:
                            kind: string_end
                            nthChild: 3
      inside:
        stopBy: end
        follows:
          stopBy: end
          kind: import_from_statement
          all:
            - has:
                nthChild: 1
                kind: dotted_name
                field: module_name
                regex: ^cassandra.auth$
            - has:
                stopBy: end
                kind: aliased_import
                all:
                  - has:
                      kind: dotted_name
                      nthChild: 1
                      regex: ^SaslAuthProvider$
                  - has:
                      kind: identifier
                      field: alias
                      nthChild: 2
                      pattern: $SASL_ALIAS

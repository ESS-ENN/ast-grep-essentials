id: python-mariadb-hardcoded-secret-python
language: python
severity: warning
message: >-
  A secret is hard-coded in the application. Secrets stored in source code, such as credentials, identifiers, and other types of sensitive data, can be leaked and used by internal or external malicious actors. Use environment variables to securely provide credentials and other secrets or retrieve them from a secure vault or Hardware Security Module (HSM).
note: >-
  [CWE-287]: Improper Authentication
  [A07:2021]: Identification and Authentication Failures
  [REFERENCES]
    - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html

rule:
  any:
    - kind: call
      has:
        nthChild: 1
        kind: attribute
        regex: ^mariadb.connect$
        precedes:
          kind: argument_list
          has:
            kind: keyword_argument
            has:
              kind: identifier
              regex: ^(password|passwd)$
              precedes:
                stopBy: end
                kind: string
                all:
                  - has:
                      kind: string_start
                      nthChild: 1
                  - has:
                      kind: string_content
                      nthChild: 2
                  - has:
                      kind: string_end
                      nthChild: 3
      inside:
        stopBy: end
        follows:
          stopBy: end
          kind: import_statement
          has:
            kind: dotted_name
            nthChild: 1
            regex: ^mariadb$
    - kind: call
      has:
        nthChild: 1
        kind: attribute
        all:
          - has:
              nthChild: 1
              pattern: $ALAIS
          - has:
              nthChild: 2
              regex: ^connect$
        precedes:
          kind: argument_list
          has:
            stopBy: end
            kind: keyword_argument
            all:
              - has:
                  kind: identifier
                  regex: ^(password|passwd)$
                  nthChild: 1
              - has:
                  kind: string
                  all:
                    - has:
                        kind: string_start
                        nthChild: 1
                    - has:
                        kind: string_content
                        nthChild: 2
                    - has:
                        kind: string_end
                        nthChild: 3
      inside:
        stopBy: end
        follows:
          stopBy: end
          kind: import_statement
          has:
            kind: aliased_import
            all:
              - has:
                  kind: dotted_name
                  regex: ^mariadb$
              - has:
                  kind: identifier
                  pattern: $ALAIS

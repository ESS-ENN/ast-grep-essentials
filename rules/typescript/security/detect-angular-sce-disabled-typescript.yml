id: detect-angular-sce-disabled-typescript
language: typescript
severity: warning
message: >-
  $sceProvider is set to false. Disabling Strict Contextual escaping
  (SCE) in an AngularJS application could provide additional attack surface
  for XSS vulnerabilities.
note: >-
  [CWE-79] Improper Neutralization of Input During Web Page Generation.
  [REFERENCES]
      - https://docs.angularjs.org/api/ng/service/$sce
      - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
utils:
  $sceProvider.enabled(false):
    kind: expression_statement
    has:
      stopBy: end
      kind: call_expression 
      all:
        - has:
            stopBy: neighbor
            kind: member_expression
            pattern: $sceProvider.enabled
        - has:
            stopBy: neighbor
            kind: arguments
            has:
              stopBy: neighbor
              regex: ^false$

rule:
 kind: expression_statement
 matches: $sceProvider.enabled(false)